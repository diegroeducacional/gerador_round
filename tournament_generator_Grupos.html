<!doctype html>
<html lang="pt-br">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Campeonato em Grupos + Eliminat√≥rias</title>
<style>
  :root{--bg:#f8fafc;--fg:#0f172a;--muted:#64748b;--card:#ffffff;--primary:#4f46e5}
  *{box-sizing:border-box} 
  body{margin:0;background:var(--bg);color:var(--fg);font:16px/1.4 system-ui,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,Arial}
  .container{max-width:1100px;margin:0 auto;padding:24px}
  h1{font-size:clamp(20px,3vw,28px);margin:0 0 4px;font-weight:800}
  .sub{color:var(--muted);font-size:14px;margin-bottom:16px}
  .grid{display:grid;gap:16px}
  @media(min-width:900px){.grid-2{grid-template-columns:1fr 1fr}}
  .card{background:var(--card);border:1px solid #e5e7eb;border-radius:16px;padding:16px;box-shadow:0 4px 16px rgba(0,0,0,.04)}
  label{font-weight:600;display:block;margin-bottom:6px}
  textarea{width:100%;min-height:180px;resize:vertical;border:1px solid #e5e7eb;border-radius:12px;padding:12px;font-family:inherit}
  input[type=range], input[type=number]{width:180px}
  input[type=number]{padding:6px 10px;border:1px solid #e5e7eb;border-radius:8px}
  .btn{display:inline-flex;align-items:center;justify-content:center;gap:8px;padding:10px 14px;border-radius:12px;border:1px solid #e5e7eb;background:#fff;cursor:pointer;font-size:14px;text-decoration:none}
  .btn.primary{background:var(--primary);border-color:var(--primary);color:#fff}
  .btn:hover{filter:brightness(.98);transform:translateY(-1px)}
  .btn:active{transform:translateY(0)}
  .muted{color:var(--muted);font-size:12px}
  .round{border:1px solid #e5e7eb;border-radius:14px;padding:12px;margin-bottom:12px;background:#fafbfc}
  .round h3{margin:0 0 8px;font-size:16px;color:var(--primary)}
  pre{white-space:pre-wrap;background:#f1f5f9;border:1px solid #e2e8f0;border-radius:12px;padding:12px;max-height:320px;overflow:auto;font-size:13px}
  .footer{color:#94a3b8;font-size:12px;text-align:center;padding:24px 0}
  .row{display:flex;align-items:center;gap:12px;flex-wrap:wrap}
  .badge{background:#eef2ff;border:1px solid #e0e7ff;color:#3730a3;padding:4px 8px;border-radius:999px;font-size:12px;font-weight:600}
  .list{margin:0;padding-left:16px}
  .list li{margin-bottom:4px}
  .success{background:#f0fdf4;border-color:#bbf7d0;color:#166534;padding:8px 12px;border-radius:8px;margin:8px 0;font-size:13px}
  .warning{background:#fffbeb;border-color:#fed7aa;color:#9a3412;padding:8px 12px;border-radius:8px;margin:8px 0;font-size:13px}
  .phase-header{background:linear-gradient(135deg,var(--primary),#6366f1);color:white;padding:12px 16px;border-radius:12px;margin:16px 0 8px;text-align:center;font-weight:700}
</style>
</head>
<body>
<div class="container">
<header>
<h1>Campeonato em Grupos + Eliminat√≥rias</h1>
<div class="sub">Fase de grupos + semifinais e final ‚Ä¢ 2‚Äì6 arenas</div>
</header>

<section class="grid grid-2">
<div class="card">
<label for="teams">Equipes (uma por linha)</label>
<textarea id="teams" placeholder="Digite o nome das equipes, uma por linha">C√≥digo Mestre
NeoBots Burity
Full torque
NUMBER ONE</textarea>

<div class="row" style="margin-top:12px">
<label style="margin:0">Arenas:</label>
<input id="arenas" type="range" min="2" max="6" step="1" value="2" />
<span id="arenasVal" class="badge">2</span>
</div>

<div class="row" style="margin-top:8px">
<label style="margin:0">N√∫mero de grupos:</label>
<input id="groups" type="number" min="1" max="10" step="1" value="2" />
<span id="groupsVal" class="badge">2</span>
</div>

<div class="row" style="margin-top:8px">
<label style="margin:0">
<input id="playoffMode" type="checkbox" checked> Incluir eliminat√≥rias
</label>
</div>

<div class="row" style="margin-top:12px">
<button id="generate" class="btn primary">üèÜ Gerar Campeonato</button>
<button id="copyTxt" class="btn">üìã Copiar Texto</button>
<button id="dlCsv" class="btn">üíæ Baixar CSV</button>
</div>

<div class="muted" style="margin-top:8px">
‚Ä¢ Duplicados s√£o removidos automaticamente<br>
‚Ä¢ Cada equipe joga no m√°ximo uma vez por rodada<br>
‚Ä¢ Eliminat√≥rias: 1¬∫ de cada grupo + melhores 2¬∫s
</div>
</div>

<div class="card">
<h2 style="margin:0 0 8px;font-size:18px">üìä Resumo</h2>
<ul class="list" id="summary">
<li><strong>Equipes:</strong> <span id="totalTeams">‚Äî</span></li>
<li><strong>Grupos:</strong> <span id="totalGroups">‚Äî</span></li>
<li><strong>Jogos fase grupos:</strong> <span id="totalGames">‚Äî</span></li>
<li><strong>Jogos eliminat√≥rias:</strong> <span id="playoffGames">‚Äî</span></li>
<li><strong>Rodadas m√≠nimas:</strong> <span id="totalRounds">‚Äî</span></li>
</ul>
</div>
</section>

<section class="card" id="scheduleCard" style="display:none">
<h2>üóìÔ∏è Calend√°rio Gerado</h2>
<div id="schedule"></div>
</section>

<section class="card" id="plainWrap" style="display:none">
<h3 style="margin-top:0">üìù Texto Simples</h3>
<pre id="plain"></pre>
</section>

<div class="footer">
Feito para organizar campeonatos de rob√≥tica. ‚öôÔ∏è‚ú®<br>
<small>Algoritmo round-robin para fase de grupos</small>
</div>
</div>

<script>
const $ = s => document.querySelector(s);
const teamsEl = $('#teams');
const arenasEl = $('#arenas');
const arenasVal = $('#arenasVal');
const groupsEl = $('#groups');
const groupsVal = $('#groupsVal');
const playoffEl = $('#playoffMode');
const summary = $('#summary');
const scheduleCard = $('#scheduleCard');
const scheduleWrap = $('#schedule');
const plainWrap = $('#plainWrap');
const plainPre = $('#plain');

// Event listeners
arenasEl.addEventListener('input', () => {
  arenasVal.textContent = arenasEl.value;
});

groupsEl.addEventListener('input', () => {
  groupsVal.textContent = groupsEl.value;
});

$('#generate').addEventListener('click', generateTournament);
$('#copyTxt').addEventListener('click', copyToClipboard);
$('#dlCsv').addEventListener('click', downloadCsv);

// Utility functions
function parseTeams(text) {
  const lines = text.split(/\r?\n/).map(s => s.trim()).filter(Boolean);
  const seen = new Set();
  const unique = [];
  
  for (const name of lines) {
    const key = name.toLowerCase();
    if (!seen.has(key)) {
      seen.add(key);
      unique.push(name);
    }
  }
  return unique;
}

function shuffleArray(array) {
  const shuffled = [...array];
  for (let i = shuffled.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
  }
  return shuffled;
}

function generateGroups(teams, numGroups) {
  const shuffled = shuffleArray(teams);
  const groups = Array(numGroups).fill().map(() => []);
  
  shuffled.forEach((team, index) => {
    groups[index % numGroups].push(team);
  });
  
  return groups.filter(group => group.length > 0);
}

function generateRoundRobinPairs(teams) {
  const n = teams.length;
  if (n < 2) return [];
  
  const isOdd = n % 2 === 1;
  const teamList = isOdd ? [...teams, 'BYE'] : [...teams];
  const totalRounds = teamList.length - 1;
  const allRounds = [];
  
  for (let round = 0; round < totalRounds; round++) {
    const pairs = [];
    
    for (let i = 0; i < Math.floor(teamList.length / 2); i++) {
      const team1 = teamList[i];
      const team2 = teamList[teamList.length - 1 - i];
      
      if (team1 !== 'BYE' && team2 !== 'BYE') {
        pairs.push({ a: team1, b: team2 });
      }
    }
    
    if (pairs.length > 0) {
      allRounds.push(pairs);
    }
    
    // Rotate teams (keep first fixed)
    const fixed = teamList[0];
    const last = teamList.pop();
    teamList.splice(1, 0, last);
  }
  
  return allRounds;
}

function allocateArenas(rounds, arenasCount) {
  const schedule = [];
  let roundNumber = 1;
  
  for (const pairs of rounds) {
    for (let i = 0; i < pairs.length; i += arenasCount) {
      const batch = pairs.slice(i, i + arenasCount);
      const slots = batch.map((match, idx) => ({
        arena: idx + 1,
        a: match.a,
        b: match.b
      }));
      
      schedule.push({
        roundNumber: roundNumber++,
        slots
      });
    }
  }
  
  return schedule;
}

function generatePlayoffs(groups) {
  if (groups.length < 2) return [];
  
  // Simulate group results and get qualifiers
  const qualifiers = [];
  
  groups.forEach((group, idx) => {
    if (group.length >= 2) {
      // First place from each group
      qualifiers.push({ team: group[0], seed: idx + 1, pos: '1¬∫' });
    }
  });
  
  // Add best second places if needed
  groups.forEach((group, idx) => {
    if (group.length >= 2 && qualifiers.length < 4) {
      qualifiers.push({ team: group[1], seed: idx + 1 + groups.length, pos: '2¬∫' });
    }
  });
  
  if (qualifiers.length < 2) return [];
  
  const playoffs = [];
  
  if (qualifiers.length >= 4) {
    // Semifinals
    playoffs.push({
      title: 'Semifinal 1',
      slots: [{
        arena: 1,
        a: qualifiers[0].team,
        b: qualifiers[3].team
      }]
    });
    
    playoffs.push({
      title: 'Semifinal 2', 
      slots: [{
        arena: 2,
        a: qualifiers[1].team,
        b: qualifiers[2].team
      }]
    });
    
    // Final
    playoffs.push({
      title: 'FINAL',
      slots: [{
        arena: 1,
        a: 'Vencedor SF1',
        b: 'Vencedor SF2'
      }]
    });
    
    // Third place
    playoffs.push({
      title: 'Disputa 3¬∫ lugar',
      slots: [{
        arena: 2,
        a: 'Perdedor SF1', 
        b: 'Perdedor SF2'
      }]
    });
  } else {
    // Direct final
    playoffs.push({
      title: 'FINAL',
      slots: [{
        arena: 1,
        a: qualifiers[0].team,
        b: qualifiers[1].team
      }]
    });
  }
  
  return playoffs;
}

function renderSchedule(groupSchedules, groups, playoffSchedule) {
  let html = '';
  const textLines = [];
  
  // Group phase
  if (groupSchedules.length > 0) {
    html += '<div class="phase-header">üèüÔ∏è FASE DE GRUPOS</div>';
    textLines.push('=== FASE DE GRUPOS ===\n');
  }
  
  groupSchedules.forEach((schedule, groupIdx) => {
    html += `<h3 style="color: var(--primary); margin: 16px 0 8px;">Grupo ${groupIdx + 1}</h3>`;
    textLines.push(`--- Grupo ${groupIdx + 1} ---`);
    
    if (groups[groupIdx]) {
      html += `<div class="muted" style="margin-bottom: 8px;">Equipes: ${groups[groupIdx].join(', ')}</div>`;
      textLines.push(`Equipes: ${groups[groupIdx].join(', ')}\n`);
    }
    
    schedule.forEach(round => {
      html += `<div class="round">`;
      html += `<h4 style="margin: 0 0 8px; font-size: 14px;">Rodada ${round.roundNumber}</h4>`;
      html += `<ul class="list">`;
      
      textLines.push(`Rodada ${round.roundNumber}:`);
      
      round.slots.forEach(slot => {
        html += `<li>Arena ${slot.arena}: <strong>${slot.a}</strong> √ó <strong>${slot.b}</strong></li>`;
        textLines.push(`  Arena ${slot.arena}: ${slot.a} √ó ${slot.b}`);
      });
      
      html += `</ul></div>`;
      textLines.push('');
    });
    
    textLines.push('');
  });
  
  // Playoffs
  if (playoffSchedule && playoffSchedule.length > 0) {
    html += '<div class="phase-header">üèÜ ELIMINAT√ìRIAS</div>';
    textLines.push('=== ELIMINAT√ìRIAS ===\n');
    
    playoffSchedule.forEach(match => {
      html += `<div class="round">`;
      html += `<h4 style="margin: 0 0 8px; font-size: 14px; color: #dc2626;">${match.title}</h4>`;
      html += `<ul class="list">`;
      
      textLines.push(`${match.title}:`);
      
      match.slots.forEach(slot => {
        html += `<li>Arena ${slot.arena}: <strong>${slot.a}</strong> √ó <strong>${slot.b}</strong></li>`;
        textLines.push(`  Arena ${slot.arena}: ${slot.a} √ó ${slot.b}`);
      });
      
      html += `</ul></div>`;
      textLines.push('');
    });
  }
  
  scheduleWrap.innerHTML = html;
  plainPre.textContent = textLines.join('\n');
  scheduleCard.style.display = 'block';
  plainWrap.style.display = 'block';
}

function updateSummary(teams, groups, totalGames, playoffGames, totalRounds) {
  $('#totalTeams').textContent = teams.length;
  $('#totalGroups').textContent = groups.length;
  $('#totalGames').textContent = totalGames;
  $('#playoffGames').textContent = playoffGames;
  $('#totalRounds').textContent = totalRounds;
}

function generateTournament() {
  const arenas = Math.max(2, Math.min(6, parseInt(arenasEl.value, 10) || 2));
  const numGroups = Math.max(1, Math.min(10, parseInt(groupsEl.value, 10) || 1));
  const includePlayoffs = playoffEl.checked;
  const teams = parseTeams(teamsEl.value);
  
  if (teams.length < 2) {
    alert('‚ö†Ô∏è Adicione pelo menos 2 equipes para gerar o campeonato.');
    return;
  }
  
  if (teams.length < numGroups) {
    alert('‚ö†Ô∏è N√∫mero de grupos n√£o pode ser maior que o n√∫mero de equipes.');
    return;
  }
  
  // Generate groups
  const groups = generateGroups(teams, numGroups);
  const groupSchedules = [];
  let totalGames = 0;
  let totalRounds = 0;
  
  // Generate group stage
  groups.forEach(group => {
    const rounds = generateRoundRobinPairs(group);
    const schedule = allocateArenas(rounds, arenas);
    groupSchedules.push(schedule);
    
    totalGames += schedule.reduce((sum, round) => sum + round.slots.length, 0);
    totalRounds += schedule.length;
  });
  
  // Generate playoffs
  let playoffSchedule = [];
  let playoffGames = 0;
  
  if (includePlayoffs && groups.length >= 2) {
    playoffSchedule = generatePlayoffs(groups);
    playoffGames = playoffSchedule.reduce((sum, match) => sum + match.slots.length, 0);
    totalRounds += playoffSchedule.length;
  }
  
  // Render everything
  renderSchedule(groupSchedules, groups, playoffSchedule);
  updateSummary(teams, groups, totalGames, playoffGames, totalRounds);
  
  // Show success message
  const successMsg = document.createElement('div');
  successMsg.className = 'success';
  successMsg.textContent = `‚úÖ Campeonato gerado com sucesso! ${totalGames + playoffGames} jogos em ${totalRounds} rodadas.`;
  scheduleCard.insertBefore(successMsg, scheduleCard.firstChild.nextSibling);
  
  setTimeout(() => successMsg.remove(), 5000);
}

async function copyToClipboard() {
  try {
    await navigator.clipboard.writeText(plainPre.textContent);
    
    const btn = $('#copyTxt');
    const original = btn.textContent;
    btn.textContent = '‚úÖ Copiado!';
    btn.style.background = '#10b981';
    btn.style.color = 'white';
    
    setTimeout(() => {
      btn.textContent = original;
      btn.style.background = '';
      btn.style.color = '';
    }, 2000);
  } catch (err) {
    alert('‚ùå Erro ao copiar. Selecione o texto manualmente.');
  }
}

function downloadCsv() {
  if (!plainPre.textContent) {
    alert('‚ö†Ô∏è Gere o campeonato primeiro.');
    return;
  }
  
  const lines = plainPre.textContent.split('\n').filter(line => line.includes('Arena'));
  const csvContent = 'Rodada,Arena,Equipe A,Equipe B\n' + 
    lines.map(line => {
      const match = line.match(/Arena (\d+): (.+) √ó (.+)/);
      if (match) {
        return `"Rodada","${match[1]}","${match[2].trim()}","${match[3].trim()}"`;
      }
      return '';
    }).filter(Boolean).join('\n');
  
  const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
  const link = document.createElement('a');
  link.href = URL.createObjectURL(blob);
  link.download = `campeonato_${new Date().toISOString().split('T')[0]}.csv`;
  link.click();
}

// Initialize
document.addEventListener('DOMContentLoaded', () => {
  groupsVal.textContent = groupsEl.value;
});
</script>
</body>
</html>